function robot = FourMassRobot (Jm, Ja1, Ja2, Ja3, k1, k2, k3, d1, d2, d3, fm, fa1, fa2, fa3,len1,len2,len3,gear_ratio)
% robot = FourMassRobot (Jm, Ja1, Ja2, Ja3, k1, k2, k3, d1, d2, d3, fm, fa1, fa2, fa3,len1,len2,len3,gear_ratio)
% 
% Returns continuous linear state space model of four mass robot
% Input: [motor_torque  motor_torque_disturbance  arm_torque_disturbance]
% Output: [motor_pos tool_pos]
% States: [motor_pos arm_pos_1 arm_pos_2 arm_pos_3 motor_speed arm_speed_1 arm_speed_2 arm_speed_3]

% Four mass state space system
A = [0 0 0 0 1 0 0 0; ...
     0 0 0 0 0 1 0 0; ...
     0 0 0 0 0 0 1 0; ...
     0 0 0 0 0 0 0 1; ...
     -k1/Jm k1/Jm  0 0 -(fm+d1)/Jm d1/Jm 0 0; ...
     k1/Ja1 -(k1+k2)/Ja1 k2/Ja1 0 d1/Ja1 -(d1+d2+fa1)/Ja1 d2/Ja1 0; ...
     0 k2/Ja2 -(k2+k3)/Ja2 k3/Ja2 0 d2/Ja2 -(d2+d3+fa2)/Ja2 d3/Ja2; ...
     0 0 k3/Ja3 -k3/Ja3 0 0 d3/Ja3 -(fa3+d3)/Ja3];

B = [0 0 0; ...
     0 0 0; ...
     0 0 0; ...
     0 0 0; ...
     1/Jm 1/Jm 0; ...
     0 0 0; ...
     0 0 0; ...
     0 0 1/Ja3];

C = [1 0 0 0 0 0 0 0; ...
     0 len1/gear_ratio len2/gear_ratio len3/gear_ratio 0 0 0 0];

D = [0 0 0; ...
     0 0 0];

robot = ss(A,B,C,D);

